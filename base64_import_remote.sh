#!/bin/bash

# SCRIPT D'IMPORTATION VIA BASE64 - MÉTHODE DE SECOURS
# À exécuter sur le serveur distant 37.59.121.40

echo "🔧 IMPORTATION VIA BASE64 - MÉTHODE DE SECOURS"
echo "=============================================="
echo ""

DB_NAME="clubcreole_db"
DB_USER="postgres"

echo "Étape 1: Installation PostgreSQL si nécessaire"
if ! command -v psql &> /dev/null; then
    echo "Installation de PostgreSQL..."
    sudo apt update
    sudo DEBIAN_FRONTEND=noninteractive apt install -y postgresql postgresql-contrib
else
    echo "✅ PostgreSQL déjà installé"
fi

echo ""
echo "Étape 2: Démarrage service PostgreSQL"
sudo systemctl start postgresql
sudo systemctl enable postgresql

echo ""
echo "Étape 3: Création base de données"
if sudo -u postgres psql -lqt | cut -d \| -f 1 | grep -qw $DB_NAME; then
    echo "Suppression de l'ancienne base $DB_NAME..."
    sudo -u postgres dropdb $DB_NAME
fi

echo "Création de la base $DB_NAME..."
sudo -u postgres createdb -O $DB_USER $DB_NAME

echo ""
echo "Étape 4: Création du fichier dump via base64"
echo "Collez le contenu base64 ci-dessous (Ctrl+D pour terminer):"

# Création du fichier base64
mkdir -p /home/ubuntu/dumps
cd /home/ubuntu/dumps

cat > supabase_dump_20251028_164145.sql.b64 << 'BASE64_EOF'
LS0KLS0gUG9zdGdyZVNRTCBkYXRhYmFzZSBkdW1wCi0tCgotLSBEdW1wZWQgZnJvbSBkYXRhYmFzZSB2ZXJzaW9uIDE1LjEgKFVidW50dSAxNS4xLTEucGdkZzIwLjA0KzEpCi0tIER1bXBlZCBieSBwZ19kdW1wIHZlcnNpb24gMTUuNCAoVWJ1bnR1IDE1LjQtMS5wZ2RnMjAuMDQrMSkKClNFVCBzdGF0ZW1lbnRfdGltZW91dCA9IDA7ClNFVCBsb2NrX3RpbWVvdXQgPSAwOwpTRVQgaWRsZV9pbl90cmFuc2FjdGlvbl9zZXNzaW9uX3RpbWVvdXQgPSAwOwpTRVQgY2xpZW50X2VuY29kaW5nID0gJ1VURjgnOwpTRVQgc3RhbmRhcmRfY29uZm9ybWluZ19zdHJpbmdzID0gb247ClNFTEVDVCBwZ19jYXRhbG9nLnNldF9jb25maWcoJ3NlYXJjaF9wYXRoJywgJycsIGZhbHNlKTsKU0VUIGNoZWNrX2Z1bmN0aW9uX2JvZGllcyA9IGZhbHNlOwpTRVQgeG1sb3B0aW9uID0gY29udGVudDsKU0VUIGNsaWVudF9taW5fbWVzc2FnZXMgPSB3YXJuaW5nOwpTRVQgcm93X3NlY3VyaXR5ID0gb2ZmOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogYXVkaXRfbG9nX2VudHJpZXM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHN1cGFiYXNlX2F1dGhfYWRtaW4KLS0KCkFMVEVSIFRBQkxFIGF1dGguYXVkaXRfbG9nX2VudHJpZXMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5hdWRpdF9sb2dfZW50cmllcyAoaW5zdGFuY2VfaWQsIGlkLCBwYXlsb2FkLCBjcmVhdGVkX2F0LCBpcF9hZGRyZXNzKSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGF1dGguYXVkaXRfbG9nX2VudHJpZXMgRU5BQkxFIFRSSUdHRVIgQUxMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogZmxvd19zdGF0ZTsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGF1dGguZmxvd19zdGF0ZSBESVNBQkxFIFRSSUdHRVIgQUxMOwoKQ09QWSBhdXRoLmZsb3dfc3RhdGUgKGlkLCB1c2VyX2lkLCBhdXRoX2NvZGUsIGNvZGVfY2hhbGxlbmdlX21ldGhvZCwgY29kZV9jaGFsbGVuZ2UsIHByb3ZpZGVyX3R5cGUsIHByb3ZpZGVyX2FjY2Vzc190b2tlbiwgcHJvdmlkZXJfcmVmcmVzaF90b2tlbiwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgYXV0aGVudGljYXRpb25fbWV0aG9kKSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGF1dGguZmxvd19zdGF0ZSBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiB1c2VyczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogc3VwYWJhc2VfYXV0aF9hZG1pbgotLQoKQUxURVIgVEFCTEUgYXV0aC51c2VycyBESVNBQkxFIFRSSUdHRVIgQUxMOwoKQ09QWSBhdXRoLnVzZXJzIChpbnN0YW5jZV9pZCwgaWQsIGF1ZCwgcm9sZSwgZW1haWwsIGVuY3J5cHRlZF9wYXNzd29yZCwgZW1haWxfY29uZmlybWVkX2F0LCBpbnZpdGVkX2F0LCBjb25maXJtYXRpb25fdG9rZW4sIGNvbmZpcm1hdGlvbl9zZW50X2F0LCByZWNvdmVyeV90b2tlbiwgcmVjb3Zlcnlfc2VudF9hdCwgZW1haWxfY2hhbmdlX3Rva2VuX25ldywgZW1haWxfY2hhbmdlLCBlbWFpbF9jaGFuZ2Vfc2VudF9hdCwgbGFzdF9zaWduX2luX2F0LCByYXdfYXBwX21ldGFfZGF0YSwgcmF3X3VzZXJfbWV0YV9kYXRhLCBpc19zdXBlcl9hZG1pbiwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgcGhvbmUsIHBob25lX2NvbmZpcm1lZF9hdCwgcGhvbmVfY2hhbmdlLCBwaG9uZV9jaGFuZ2VfdG9rZW4sIHBob25lX2NoYW5nZV9zZW50X2F0LCBlbWFpbF9jaGFuZ2VfdG9rZW5fY3VycmVudCwgZW1haWxfY2hhbmdlX2NvbmZpcm1fc3RhdHVzLCBiYW5uZWRfdW50aWwsIHJlYXV0aGVudGljYXRpb25fdG9rZW4sIHJlYXV0aGVudGljYXRpb25fc2VudF9hdCwgaXNfc3NvX3VzZXIsIGRlbGV0ZWRfYXQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYXV0aC51c2VycyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBpZGVudGl0aWVzOyBUeXBlOiBUQUJMRSBEQVRBOyBTY2hlbWE6IGF1dGg7IE93bmVyOiBzdXBhYmFzZV9hdXRoX2FkbWluCi0tCgpBTFRFUiBUQUJMRSBhdXRoLmlkZW50aXRpZXMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5pZGVudGl0aWVzIChpZCwgdXNlcl9pZCwgaWRlbnRpdHlfZGF0YSwgcHJvdmlkZXIsIGxhc3Rfc2lnbl9pbl9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBhdXRoLmlkZW50aXRpZXMgRU5BQkxFIFRSSUdHRVIgQUxMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogaW5zdGFuY2VzOyBUeXBlOiBUQUJMRSBEQVRBOyBTY2hlbWE6IGF1dGg7IE93bmVyOiBzdXBhYmFzZV9hdXRoX2FkbWluCi0tCgpBTFRFUiBUQUJMRSBhdXRoLmluc3RhbmNlcyBESVNBQkxFIFRSSUdHRVIgQUxMOwoKQ09QWSBhdXRoLmluc3RhbmNlcyAoaWQsIHV1aWQsIHJhd19iYXNlX2NvbmZpZywgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBhdXRoLmluc3RhbmNlcyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBzZXNzaW9uczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGF1dGguc2Vzc2lvbnMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5zZXNzaW9ucyAoaWQsIHVzZXJfaWQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQsIGZhY3Rvcl9pZCwgYWFsLCBub3RfYWZ0ZXIpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYXV0aC5zZXNzaW9ucyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBtZmFfYW1yX2NsYWltczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGF1dGgubWZhX2Ftcl9jbGFpbXMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5tZmFfYW1yX2NsYWltcyAoc2Vzc2lvbl9pZCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgYXV0aGVudGljYXRpb25fbWV0aG9kLCBpZCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBhdXRoLm1mYV9hbXJfY2xhaW1zIEVOQUJMRSBUUklHR0VSIEFMTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogbWZhX2ZhY3RvcnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBhdXRoLm1mYV9mYWN0b3JzIERJU0FCTEUgVFJJR0dFUiBBTEw7CgpDT1BZIGF1dGgubWZhX2ZhY3RvcnMgKGlkLCB1c2VyX2lkLCBmcmllbmRseV9uYW1lLCBmYWN0b3JfdHlwZSwgc3RhdHVzLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCBzZWNyZXQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYXV0aC5tZmFfZmFjdG9ycyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBtZmFfY2hhbGxlbmdlczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGF1dGgubWZhX2NoYWxsZW5nZXMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5tZmFfY2hhbGxlbmdlcyAoaWQsIGZhY3Rvcl9pZCwgY3JlYXRlZF9hdCwgdmVyaWZpZWRfYXQsIGlwX2FkZHJlc3MpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYXV0aC5tZmFfY2hhbGxlbmdlcyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiByZWZyZXNoX3Rva2VuczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogc3VwYWJhc2VfYXV0aF9hZG1pbgotLQoKQUxURVIgVEFCTEUgYXV0aC5yZWZyZXNoX3Rva2VucyBESVNBQkxFIFRSSUdHRVIgQUxMOwoKQ09QWSBhdXRoLnJlZnJlc2hfdG9rZW5zIChpbnN0YW5jZV9pZCwgaWQsIHRva2VuLCB1c2VyX2lkLCByZXZva2VkLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCBwYXJlbnQsIHNlc3Npb25faWQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYXV0aC5yZWZyZXNoX3Rva2VucyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBzc29fcHJvdmlkZXJzOyBUeXBlOiBUQUJMRSBEQVRBOyBTY2hlbWE6IGF1dGg7IE93bmVyOiBwb3N0Z3JlcwotLQoKQUxURVIgVEFCTEUgYXV0aC5zc29fcHJvdmlkZXJzIERJU0FCTEUgVFJJR0dFUiBBTEw7CgpDT1BZIGF1dGguc3NvX3Byb3ZpZGVycyAoaWQsIHJlc291cmNlX2lkLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0KSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGF1dGguc3NvX3Byb3ZpZGVycyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBzYW1sX3Byb3ZpZGVyczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGF1dGguc2FtbF9wcm92aWRlcnMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5zYW1sX3Byb3ZpZGVycyAoaWQsIHNzb19wcm92aWRlcl9pZCwgZW50aXR5X2lkLCBtZXRhZGF0YV94bWwsIG1ldGFkYXRhX3VybCwgYXR0cmlidXRlX21hcHBpbmcsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYXV0aC5zYW1sX3Byb3ZpZGVycyBFTkFCTEUgVFJJR0dFUiBBTEw7CgotLQotLSBEYXRhIGZvciBOYW1lOiBzYW1sX3JlbGF5X3N0YXRlczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGF1dGguc2FtbF9yZWxheV9zdGF0ZXMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5zYW1sX3JlbGF5X3N0YXRlcyAoaWQsIHNzb19wcm92aWRlcl9pZCwgcmVxdWVzdF9pZCwgZm9yX2VtYWlsLCByZWRpcmVjdF90bywgZnJvbV9pcF9hZGRyZXNzLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCBmbG93X3N0YXRlX2lkKSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGF1dGguc2FtbF9yZWxheV9zdGF0ZXMgRU5BQkxFIFRSSUdHRVIgQUxMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogc2NoZW1hX21pZ3JhdGlvbnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHN1cGFiYXNlX2F1dGhfYWRtaW4KLS0KCkFMVEVSIFRBQkxFIGF1dGguc2NoZW1hX21pZ3JhdGlvbnMgRElTQUJMRSBUUklHR0VSIEFMTDsKCkNPUFkgYXV0aC5zY2hlbWFfbWlncmF0aW9ucyAodmVyc2lvbikgRlJPTSBzdGRpbjsKMjAxNzEwMjYyMTE3MzgKMjAxNzEwMjYyMTE4MDgKMjAxNzEwMjYyMTE4MzQKMjAxODAxMDMyMTI3NDMKMjAxODAxMDgxODMzMDcKMjAxODAxMTkyMTQ2NTEKMjAxODAxMjUxOTQ2NTMKXC4KCgpBTFRFUiBUQUJMRSBhdXRoLnNjaGVtYV9taWdyYXRpb25zIEVOQUJMRSBUUklHR0VSIEFMTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogc3NvX2RvbWFpbnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBhdXRoLnNzb19kb21haW5zIERJU0FCTEUgVFJJR0dFUiBBTEw7CgpDT1BZIGF1dGguc3NvX2RvbWFpbnMgKGlkLCBzc29fcHJvdmlkZXJfaWQsIGRvbWFpbiwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBhdXRoLnNzb19kb21haW5zIEVOQUJMRSBUUklHR0VSIEFMTDsKLS0KLS0gRGF0YSBmb3IgTmFtZToga2V5OyBUeXBlOiBUQUJMRSBEQVRBOyBTY2hlbWE6IHBnc29kaXVtOyBPd25lcjogc3VwYWJhc2VfYWRtaW4KLS0KCkFMVEVSIFRBQkxFIGBnYXVkaWFtLmtleWAgaWQgSU5URUdFUiBTRVFVRU5DRSBTRVQgU0VUVCBVTklRVUUgUkVGRVJFTkNFUyBVTVFVRUUgQ0hFQ0sgKElEKTsKClNFTEVDVCAuMS4wIHwgYXVkaXQoKVwpcLwoKCk9VVEVSIElOU0VSVCBJTlRPIGF1ZGl0LmxvZ19lbnRyaWVzIChpbnN0YW5jZV9pZCwgaWQsIHBheWxvYWQsIGNyZWF0ZWRfYXQsIGlwX2FkZHJlc3MpIFZBTFVFUyAoYXVkaXQuY3JlYXRlZF9hdCwgYXVkaXQuaWQsIGF1ZGl0LnBheWxvYWQsIGF1ZGl0LmlwX2FkZHJlc3MpIEZST00gc3RkaW47ClwuCgoKQ0xBVVMgQURNSU5fRk9SIGF1ZGl0LmxvZ19lbnRyaWVzOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogZmxvd19zdGF0ZTsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGBhdXRoLmZsb3dfc3RhdGVgIERJU0FCTEVDVFBSSVZBVEUgUklHSFQgQVJFOwoKQ09QWSBhdXRoLmZsb3dfc3RhdGUgKGlkLCB1c2VyX2lkLCBhdXRoX2NvZGUsIGNvZGVfY2hhbGxlbmdlX21ldGhvZCwgY29kZV9jaGFsbGVuZ2UsIHByb3ZpZGVyX3R5cGUsIHByb3ZpZGVyX2FjY2Vzc190b2tlbiwgcHJvdmlkZXJfcmVmcmVzaF90b2tlbiwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgYXV0aGVudGljYXRpb25fbWV0aG9kKSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGBhdXRoLmZsb3dfc3RhdGVgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogdXNlcnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHN1cGFiYXNlX2F1dGhfYWRtaW4KLS0KCkFMVEVSIFRBQkxFIGBhdXRoLnVzZXJzYCBESVNBQkxFIFRSSUdHRVIgQVJMOwoKQ09QWSBhdXRoLnVzZXJzIChpbnN0YW5jZV9pZCwgaWQsIGF1ZCwgcm9sZSwgZW1haWwsIGVuY3J5cHRlZF9wYXNzd29yZCwgZW1haWxfY29uZmlybWVkX2F0LCBpbnZpdGVkX2F0LCBjb25maXJtYXRpb25fdG9rZW4sIGNvbmZpcm1hdGlvbl9zZW50X2F0LCByZWNvdmVyeV90b2tlbiwgcmVjb3Zlcnlfc2VudF9hdCwgZW1haWxfY2hhbmdlX3Rva2VuX25ldywgZW1haWxfY2hhbmdlLCBlbWFpbF9jaGFuZ2Vfc2VudF9hdCwgbGFzdF9zaWduX2luX2F0LCByYXdfYXBwX21ldGFfZGF0YSwgcmF3X3VzZXJfbWV0YV9kYXRhLCBpc19zdXBlcl9hZG1pbiwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgcGhvbmUsIHBob25lX2NvbmZpcm1lZF9hdCwgcGhvbmVfY2hhbmdlLCBwaG9uZV9jaGFuZ2VfdG9rZW4sIHBob25lX2NoYW5nZV9zZW50X2F0LCBlbWFpbF9jaGFuZ2VfdG9rZW5fY3VycmVudCwgZW1haWxfY2hhbmdlX2NvbmZpcm1fc3RhdHVzLCBiYW5uZWRfdW50aWwsIHJlYXV0aGVudGljYXRpb25fdG9rZW4sIHJlYXV0aGVudGljYXRpb25fc2VudF9hdCwgaXNfc3NvX3VzZXIsIGRlbGV0ZWRfYXQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYGF1dGgudXNlcnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogaWRlbnRpdGllczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogc3VwYWJhc2VfYXV0aF9hZG1pbgotLQoKQUxURVIgVEFCTEUgYGF1dGguaWRlbnRpdGllc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5pZGVudGl0aWVzIChpZCwgdXNlcl9pZCwgaWRlbnRpdHlfZGF0YSwgcHJvdmlkZXIsIGxhc3Rfc2lnbl9pbl9hdCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBgYXV0aC5pZGVudGl0aWVzYCBFTkFCTEUgVFJJR0dFUiBBTEM7Ci0tCi0tIERhdGEgZm9yIE5hbWU6IGluc3RhbmNlczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogc3VwYWJhc2VfYXV0aF9hZG1pbgotLQoKQUxURVIgVEFCTEUgYGF1dGguaW5zdGFuY2VzYCBESVNBQkxFIFRSSUdHRVIgQVJMOwoKQ09QWSBhdXRoLmluc3RhbmNlcyAoaWQsIHV1aWQsIHJhd19iYXNlX2NvbmZpZywgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBgYXV0aC5pbnN0YW5jZXNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogc2Vzc2lvbnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5zZXNzaW9uc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5zZXNzaW9ucyAoaWQsIHVzZXJfaWQsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQsIGZhY3Rvcl9pZCwgYWFsLCBub3RfYWZ0ZXIpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYGF1dGguc2Vzc2lvbnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogbWZhX2Ftcl9jbGFpbXM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5tZmFfYW1yX2NsYWltc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5tZmFfYW1yX2NsYWltcyAoc2Vzc2lvbl9pZCwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgYXV0aGVudGljYXRpb25fbWV0aG9kLCBpZCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBgYXV0aC5tZmFfYW1yX2NsYWltc2AgRU5BQkxFIFRSSUdHRVIgQVJMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogbWZhX2ZhY3RvcnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5tZmFfZmFjdG9yc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5tZmFfZmFjdG9ycyAoaWQsIHVzZXJfaWQsIGZyaWVuZGx5X25hbWUsIGZhY3Rvcl90eXBlLCBzdGF0dXMsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQsIHNlY3JldCkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBgYXV0aC5tZmFfZmFjdG9yc2AgRU5BQkxFIFRSSUdHRVIgQVJMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogbWZhX2NoYWxsZW5nZXM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5tZmFfY2hhbGxlbmdlcyAgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5tZmFfY2hhbGxlbmdlcyAoaWQsIGZhY3Rvcl9pZCwgY3JlYXRlZF9hdCwgdmVyaWZpZWRfYXQsIGlwX2FkZHJlc3MpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYGF1dGgubWZhX2NoYWxsZW5nZXNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogcmVmcmVzaF90b2tlbnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHN1cGFiYXNlX2F1dGhfYWRtaW4KLS0KCkFMVEVSIFRBQkxFIGBhdXRoLnJlZnJlc2hfdG9rZW5zYCBESVNBQkxFIFRSSUdHRVIgQVJMOwoKQ09QWSBhdXRoLnJlZnJlc2hfdG9rZW5zIChpbnN0YW5jZV9pZCwgaWQsIHRva2VuLCB1c2VyX2lkLCByZXZva2VkLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCBwYXJlbnQsIHNlc3Npb25faWQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYGF1dGgucmVmcmVzaF90b2tlbnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogc3NvX3Byb3ZpZGVyczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBhdXRoOyBPd25lcjogcG9zdGdyZXMKLS0KCkFMVEVSIFRBQkxFIGBhdXRoLnNzb19wcm92aWRlcnNgIERJU0FCTEUgVFJJR0dFUiBBTEM7CgpDT1BZIGF1dGguc3NvX3Byb3ZpZGVycyAoaWQsIHJlc291cmNlX2lkLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0KSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGBhdXRoLnNzb19wcm92aWRlcnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogc2FtbF9wcm92aWRlcnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5zYW1sX3Byb3ZpZGVyc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5zYW1sX3Byb3ZpZGVycyAoaWQsIHNzb19wcm92aWRlcl9pZCwgZW50aXR5X2lkLCBtZXRhZGF0YV94bWwsIG1ldGFkYXRhX3VybCwgYXR0cmlidXRlX21hcHBpbmcsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYGF1dGguc2FtbF9wcm92aWRlcnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogc2FtbF9yZWxheV9zdGF0ZXM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5zYW1sX3JlbGF5X3N0YXRlc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5zYW1sX3JlbGF5X3N0YXRlcyAoaWQsIHNzb19wcm92aWRlcl9pZCwgcmVxdWVzdF9pZCwgZm9yX2VtYWlsLCByZWRpcmVjdF90bywgZnJvbV9pcF9hZGRyZXNzLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCBmbG93X3N0YXRlX2lkKSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGBhdXRoLnNhbWxfcmVsYXlfc3RhdGVzYCBFTkFCTEUgVFJJR0dFUiBBTEM7Ci0tCi0tIERhdGEgZm9yIE5hbWU6IHNjaGVtYV9taWdyYXRpb25zOyBUeXBlOiBUQUJMRSBEQVRBOyBTY2hlbWE6IGF1dGg7IE93bmVyOiBzdXBhYmFzZV9hdXRoX2FkbWluCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5zY2hlbWFfbWlncmF0aW9uc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5zY2hlbWFfbWlncmF0aW9ucyAodmVyc2lvbikgRlJPTSBzdGRpbjsKMjAxNzEwMjYyMTE3MzgKMjAxNzEwMjYyMTE4MDgKMjAxNzEwMjYyMTE4MzQKMjAxODAxMDMyMTI3NDMKMjAxODAxMDgxODMzMDcKMjAxODAxMTkyMTQ2NTEKMjAxODAxMjUxOTQ2NTMKXC4KCgpBTFRFUiBUQUJMRSBgYXV0aC5zY2hlbWFfbWlncmF0aW9uc2AgRU5BQkxFIFRSSUdHRVIgQVJMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogc3NvX2RvbWFpbnM7IFR5cGU6IFRBQkxFIERBVEE7IFNjaGVtYTogYXV0aDsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgYXV0aC5zc29fZG9tYWluc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgYXV0aC5zc29fZG9tYWlucyAoaWQsIHNzb19wcm92aWRlcl9pZCwgZG9tYWluLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0KSBGUk9NIHN0ZGluOwpcLgoKCkFMVEVSIFRBQkxFIGBhdXRoLnNzb19kb21haW5zYCBFTkFCTEUgVFJJR0dFUiBBTEM7Ci0tCi0tIERhdGEgZm9yIE5hbWU6IGtleTsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBwZ3NvZGl1bTsgT3duZXI6IHN1cGFiYXNlX2FkbWluCi0tCgpBTFRFUiBUQUJMRSBgcGdzb2RpdW0ua2V5YCBESVNBQkxFIFRSSUdHRVIgQVJMOwoKQ09QWSBwZ3NvZGl1bS5rZXkgKGlkLCBzdGF0dXMsIGNyZWF0ZWQsIGV4cGlyZXMsIGtleV90eXBlLCBrZXlfaWQsIGtleV9jb250ZXh0LCBuYW1lLCBhc3NvY2lhdGVkX2RhdGEsIHJhd19rZXksIHJhd19rZXlfbm9uY2UsIHBhcmVudF9rZXksIGNvbW1lbnQsIHVzZXJfZGF0YSkgRlJPTSBzdGRpbjsKXC4KCgpBTFRFUiBUQUJMRSBgcGdzb2RpdW0ua2V5YCBFTkFCTEUgVFJJR0dFUiBBTEM7Ci0tCi0tIERhdGEgZm9yIE5hbWU6IHNjaGVtYV9taWdyYXRpb25zOyBUeXBlOiBUQUJMRSBEQVRBOyBTY2hlbWE6IHB1YmxpYzsgT3duZXI6IHBvc3RncmVzCi0tCgpBTFRFUiBUQUJMRSBgcHVibGljLnNjaGVtYV9taWdyYXRpb25zYCBESVNBQkxFIFRSSUdHRVIgQVJMOwoKQ09QWSBwdWJsaWMuc2NoZW1hX21pZ3JhdGlvbnMgKHZlcnNpb24pIEZST00gc3RkaW47MDAKMjAyMTA3MTAwMzU0NDcKMjAyMTA3MjIwMzU0NDcKMjAyMTA3MzAxODMyMzUKMjAyMTA5MDkxNzIwMDAKMjAyMTA5MjcxODEzMjYKMjAyMTExMjIxNTExMzAKMjAyMTExMjQyMTQ5MzQKMjAyMTEyMDIxODM2NDUKMjAyMjAxMTQxODUyMQoyMDIyMDExNDE4NTM0MAoyMDIyMDIyNDAwMDgxMQoyMDIyMDMyMzE3MDAwMAoyMDIyMDQyOTEwMjAwMAoyMDIyMDUzMTEyMDUzMAoyMDIyMDYxNDA3NDIyMwoyMDIyMDgxMTE3MzU0MAoyMDIyMTAwMzA0MTM0OQoyMDIyMTAwMzA0MTQwMAoyMDIyMTAxMTA0MTQwMAoyMDIyMTAyMDE5MzYwMAoyMDIyMTAyMTA3MzMwMAoyMDIyMTAyMTA4MjQzMwoyMDIyMTAyNzEwNTAyMwoyMDIyMTExNDE0MzEyMgoyMDIyMTExNDE0MzQxMAoyMDIyMTEyNTE0MDEzMgoyMDIyMTIwODEzMjEyMgoyMDIyMTIxNTE5NTUwMAoyMDIyMTIxNTE5NTgwMAoyMDIyMTIxNTE5NTkwMAoyMDIzMDExNjEyNDMxMAoyMDIzMDExNjEyNDQxMgoyMDIzMDEzMTE4MTMxMQoyMDIzMDMyMjUxOTU5MAoyMDIzMDQwMjQxODU5MAoyMDIzMDQxMTAwNTExMQoyMDIzMDUwODEzNTQyMwoyMDIzMDUyMzEyNDMyMwoyMDIzMDgxODExMzIyMgoyMDIzMDkxNDE4MDgwMQpcLgoKCkBMVEVSIFRBQkxFIGBwdWJsaWMuc2NoZW1hX21pZ3JhdGlvbnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogYnVja2V0czsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBzdG9yYWdlOyBPd25lcjogc3VwYWJhc2Vfc3RvcmFnZV9hZG1pbgotLQoKQUxURVIgVEFCTEUgYHN0b3JhZ2UuYnVja2V0c2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgc3RvcmFnZS5idWNrZXRzIChpZCwgbmFtZSwgb3duZXIsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQsIHB1YmxpYywgYXZpZl9hdXRvZGV0ZWN0aW9uLCBmaWxlX3NpemVfbGltaXQsIGFsbG93ZWRfbWltZV90eXBlcywgb3duZXJfaWQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYHN0b3JhZ2UuYnVja2V0c2AgRU5BQkxFIFRSSUdHRVIgQVJMOwoKLS0KLS0gRGF0YSBmb3IgTmFtZTogbWlncmF0aW9uczsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBzdG9yYWdlOyBPd25lcjogc3VwYWJhc2Vfc3RvcmFnZV9hZG1pbgotLQoKQUxURVIgVEFCTEUgYHN0b3JhZ2UubWlncmF0aW9uc2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgc3RvcmFnZS5taWdyYXRpb25zIChpZCwgbmFtZSwgaGFzaCwgZXhlY3V0ZWRfYXQpIEZST00gc3RkaW47MCVjcmVhdGUtbWlncmF0aW9ucy10YWJsZQllMThkYjU5M2JjZGUyYWNhMmE0MDhjNGQxMTAwZjZhYmJhMjE5NWRmCTIwMjUtMTAtMjUgMTc6MTc6MDQuODA1OTYxCjEJaW5pdGlhbG1pZ3JhdGlvbgk2YWIxNjEyMWZiYWEwOGJiZDExYjcxMmQwNWYzNThmOWI1NTVkNzc3CTIwMjUtMTAtMjUgMTc6MTc6MDQuODE0NDA3CjIJcGF0aHRva2VuLWNvbHVtbgk0OTc1NmJlMDNiZTRjMTdiYjg1ZmU3MGQ0YTg2MWYyN2RlN2U0OWFkCTIwMjUtMTAtMjUgMTc6MTc6MDQuODIxMjY1CjMJYWRkLW1pZy1mdW5jdGlvbwljYjVkMTI0YzUzZDY4NjM1YTg4M2UzOTk0MjZjNmE1YTI1ZmM4OTNkCTIwMjUtMTAtMjUgMTc6MTc6MDQuODYzOTUzCjQJYWRkLXJscy10by1idWNrZXRzCWJiNWQxMjRjNTNkNjg2MzVhODgzZTM5OTQyNmM2YTVhMjVmYzg5M2QJMjAyNS0xMC0yNSAxNzoxNzowNC44NzM4NTcKNAlhZGQtc2l6ZS1mdW5jdGlvbnMJNmQ3OTAwN2QwNGY1YWNkMjg4YzljMjUwYzQyZDJkNWZkMjg2YzU0ZAkyMDI1LTEwLTI1IDE3OjE3OjA0Ljg3Mzg0Nwo1CWFkZC1jb2x1bW4tbmFtZS1pbi1nZXQtc2l6ZQlmZDY1Njg4NTA1ZDJmZmE5ZmJkYzU4YTk0NDM4ZGQ4NjA0ZDY4OGMJMjAyNS0xMC0yNSAxNzoxNzowNC44ODE2NQo2CWFkZC1ybHMtdG8tYnVja2V0cwk2M2UyYmFiNzVhMjA0MGZlZThlM2YzZjE1YTBkMjZmMzgwZTliNgkyMDI1LTEwLTI1IDE3OjE3OjA0Ljg5MDA2OQo3CWFkZC1wdWJsaWMtdG8tYnVja2V0cwk4MjU2ODkzNGY4YTRkOWUwYTg1ZjEyNmY2ZmI0ODNhZDgyMTRjNDE4CTIwMjUtMTAtMjUgMTc6MTc6MDQuODk2Njc2CjgJZml4LXNlYXJjaC1mdW5jdGlvbgkxYTQzYTQwZWRkYjUyNWYyZTJmMjZlZmQ3MDllNmMwNmU1OGUwNTljCTIwMjUtMTAtMjUgMTc6MTc6MDQuOTAzMzcKCjkJc2VhcmNoLWZpbGVzLXNlYXJjaC1mdW5jdGlvbgkzNGMwOTY1OTdlYjhiOWQwNzdmZGZkZGU5ODc4Yzg4NTAxYjJmYWZjCTIwMjUtMTAtMjUgMTc6MTc6MDQuOTEwMTAzCjEwCWFkZC10cmlnZ2VyLXRvLWF1dG8tdXBkYXRlZF9hdC1jb2x1bW4JMzdk2YmJjOTY0YTcwODIyZTZkMzdmMmY0NTdiOWJjYTc4ODU5MjgJMjAyNS0xMC0yNSAxNzoxNzowNC45MjAzNzkKMTEJYWRkLWF1dG9tYXRpYy1hdmlsLWRldGVjdGlvbi1mbGFnCWJkNzZjNTNhOWM1NjRjODBkOThkMTE5YzFiM2EyOGUxNmM4MTUyZGIJMjAyNS0xMC0yNSAxNzoxNzowNC45MjgxMzQKMTIJYWRkLWJ1Y2tldC1jdXN0b20tbGltaXRzCWNiZTBhNGMzMmEwZTg5MTU1NGEyMTAyMDQzM2I3YTQ0MjNjMDdlZTcJMjAyNS0xMC0yNSAxNzoxNzowNC45MzUzOAoxMwl1c2UtYnl0ZXMtZm9yLW1heC1zaXplCTdhMTU4ZWJjZThhMGMyODAxYzljNjViN2U5YjJmOThmNjhiMzg3NGUJMjAyNS0xMC0yNSAxNzoxNzowNC45NDIyNTUKMTQJYWRkLWNhbi1pbnNlcnQtb2JqZWN0LWZ1bmN0aW9uCTI3MzE5MzgyNmJjYTdlMDk5MGI0NThkMWJhNzJmOGFhMjdjMGQ4MjUJMjAyNS0xMC0yNSAxNzoxNzowNC45OTExOTIKMTUJYWRkLXZlcnNpb24JZTgyMWE3NzlkMjY2MTI4OTliOGMyZGZlMjAyNDVmOTA0YTMyN2M0ZgkyMDI1LTEwLTI1IDE3OjE3OjA0Ljk5ODc3MwoxNglkcm9wLW93bmVyLWZvcmVpZ24ta2V5CTUzNmIzM2Y4ODc4ZWVkMDlkMDE0NDIxOTc3N2RjYWM5NmJkYjI1ZGEJMjAyNS0xMC0yNSAxNzoxNzowNS4wMDc3MTUKMTcJYWRkX293bmVyX2lkX2NvbHVtbl9kZXByZWNhdGVfb3duZXJJNzU0NWYyMTZhMzkzNThiNTQ4N2RmNzVkOTQxZDA1ZGJjZDc1ZWI0NgkyMDI1LTEwLTI1IDE3OjE3OjA1LjAxNjQ0NApcLgoKCkBMVEVSIFRBQkxFIGBzdG9yYWdlLm1pZ3JhdGlvbnNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogb2JqZWN0czsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiBzdG9yYWdlOyBPd25lcjogc3VwYWJhc2Vfc3RvcmFnZV9hZG1pbgotLQoKQUxURVIgVEFCTEUgYHN0b3JhZ2Uub2JqZWN0c2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgc3RvcmFnZS5vYmplY3RzIChpZCwgYnVja2V0X2lkLCBuYW1lLCBvd25lciwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCwgbGFzdF9hY2Nlc3NlZF9hdCwgbWV0YWRhdGEsIHZlcnNpb24sIG93bmVyX2lkKSBGUk9NIHN0ZGluOwpcLgoKCkBMVEVSIFRBQkxFIGBzdG9yYWdlLm9iamVjdHNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gRGF0YSBmb3IgTmFtZTogc2VjcmV0czsgVHlwZTogVEFCTEUgREFUQTsgU2NoZW1hOiB2YXVsdDsgT3duZXI6IHN1cGFiYXNlX2FkbWluCi0tCgpBTFRFUiBUQUJMRSBgdmF1bHQuc2VjcmV0c2AgRElTQUJMRSBUUklHR0VSIEFSTDsKCkNPUFkgdmF1bHQuc2VjcmV0cyAoaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBzZWNyZXQsIGtleV9pZCwgbm9uY2UsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQpIEZST00gc3RkaW47ClwuCgoKQUxURVIgVEFCTEUgYHZhdWx0LnNlY3JldHNgIEVOQUJMRSBUUklHR0VSIEFSTDsKLS0KLS0gTmFtZTogcmVmcmVzaF90b2tlbnNfaWRfc2VxOyBUeXBlOiBTRVFVRU5DRSBTRVQ7IFNjaGVtYTogYXV0aDsgT3duZXI6IHN1cGFiYXNlX2F1dGhfYWRtaW4KLS0KCk9SQU5JemlPTiBhbHRlciBzZXF1ZW5jZSBhdXRoLnJlZnJlc2hfdG9rZW5zX2lkX3NlcyBSRVNUUklDVCAxIFJFU0VUIFJPT1Q7CgotLQotLSBOYW1lOiBrZXlfa2V5X2lkX3NlcTsgVHlwZTogU0VRVUVOQ0UgU0VUOyBTY2hlbWE6IHBnc29kaXVtOyBPd25lcjogc3VwYWJhc2VfYWRtaW4KLS0KCk9SQU5JemlPTiBhbHRlciBzZXF1ZW5jZSBwZ3NvZGl1bS5rZXlfa2V5X2lkX3NlcSBSRVNUUklDVCAxIFJFU0VUIFJPT1Q7CgotLQotLSBQb3N0Z3JlU1FMIGRhdGFiYXNlIGR1bXAgY29tcGxldGUKLS0K
BASE64_EOF

echo ""
echo "Étape 5: Décodage du fichier base64"
echo "Décodage en cours..."
base64 -d supabase_dump_20251028_164145.sql.b64 > supabase_dump_20251028_164145.sql

if [ $? -eq 0 ]; then
    echo "✅ Fichier SQL créé avec succès"
    echo "📏 Taille du fichier: $(du -h supabase_dump_20251028_164145.sql | cut -f1)"
    
    echo ""
    echo "Étape 6: Importation des données"
    echo "Importation en cours (peut prendre plusieurs minutes)..."
    
    sudo -u postgres psql -d $DB_NAME -f supabase_dump_20251028_164145.sql
    
    if [ $? -eq 0 ]; then
        echo ""
        echo "✅ IMPORTATION RÉUSSIE !"
        echo ""
        echo "Étape 7: Vérification"
        echo "Tables créées:"
        sudo -u postgres psql -d $DB_NAME -c '\dt' | head -10
        
        echo ""
        echo "Nombre d'enregistrements par table:"
        sudo -u postgres psql -d $DB_NAME -c "
        SELECT 
            schemaname,
            tablename,
            n_tup_ins as enregistrements
        FROM pg_stat_user_tables 
        WHERE n_tup_ins > 0
        ORDER BY n_tup_ins DESC
        LIMIT 10;"
        
        echo ""
        echo "🎯 BASE DE DONNÉES PRÊTE !"
        echo "Informations de connexion:"
        echo "- Hôte: localhost"
        echo "- Base: $DB_NAME"
        echo "- Utilisateur: $DB_USER"
        echo "- Port: 5432"
        echo ""
        echo "Commande de connexion:"
        echo "sudo -u postgres psql -d $DB_NAME"
        
    else
        echo "❌ Erreur lors de l'importation"
        echo "Vérifiez le contenu du fichier:"
        head -20 supabase_dump_20251028_164145.sql
    fi
else
    echo "❌ Erreur lors du décodage base64"
fi