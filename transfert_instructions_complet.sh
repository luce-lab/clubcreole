#!/bin/bash

# Instructions complètes pour le transfert du dump Supabase vers le serveur distant

echo "=== INSTRUCTIONS COMPLÈTES DE TRANSFERT ==="
echo ""
echo "📁 Fichier à transférer: supabase_dump_20251028_164145.sql (10,310 octets)"
echo "🖥️  Serveur distant: 37.59.121.40"
echo "👤 Utilisateur: ubuntu"
echo "🔑 Mot de passe: Catilo"
echo ""
echo "=== ÉTAPE 1: Démarrer le serveur HTTP local ==="
echo ""
echo "Ouvrez un nouveau terminal et exécutez:"
echo "cd /home/laurent/mesprojets/clubcreole"
echo "python3 -m http.server 8888 --directory transfer_files"
echo ""
echo "Le serveur démarrera sur http://172.28.114.141:8888"
echo ""
echo "=== ÉTAPE 2: Se connecter au serveur distant ==="
echo ""
echo "Dans votre terminal actuel:"
echo "ssh ubuntu@37.59.121.40"
echo "(mot de passe: Catilo)"
echo ""
echo "=== ÉTAPE 3: Télécharger le fichier sur le serveur distant ==="
echo ""
echo "Une fois connecté au serveur distant, exécutez:"
echo "mkdir -p /home/ubuntu/dumps"
echo "cd /home/ubuntu/dumps"
echo "wget http://172.28.114.141:8888/supabase_dump_20251028_164145.sql"
echo ""
echo "=== ÉTAPE 4: Vérifier le transfert ==="
echo ""
echo "Sur le serveur distant:"
echo "ls -la supabase_dump_20251028_164145.sql"
echo "file supabase_dump_20251028_164145.sql"
echo ""
echo "=== ALTERNATIVE: Transfert par copier-coller base64 ==="
echo ""
echo "Si le HTTP ne fonctionne pas, utilisez la méthode base64:"
echo "1. Copiez le contenu du fichier: cat supabase_dump_encoded.txt"
echo "2. Sur le serveur distant:"
echo "   mkdir -p /home/ubuntu/dumps"
echo "   cd /home/ubuntu/dumps"
echo "   cat > supabase_dump_20251028_164145.sql.b64"
echo "   # collez le contenu base64 ici"
echo "   base64 -d supabase_dump_20251028_164145.sql.b64 > supabase_dump_20251028_164145.sql"
echo ""
echo "=== TEST DE CONNEXION ==="
echo ""

# Test de connexion simple
timeout 5 bash -c "</dev/tcp/37.59.121.40/22" && echo "✅ Connexion SSH possible au serveur distant" || echo "❌ Connexion SSH échouée"

echo ""
echo "Serveur HTTP local prêt: http://172.28.114.141:8888"
echo "Contenu disponible:"
ls -la transfer_files/