#!/bin/bash

# Instructions complÃ¨tes pour le transfert du dump Supabase vers le serveur distant

echo "=== INSTRUCTIONS COMPLÃˆTES DE TRANSFERT ==="
echo ""
echo "ðŸ“ Fichier Ã  transfÃ©rer: supabase_dump_20251028_164145.sql (10,310 octets)"
echo "ðŸ–¥ï¸  Serveur distant: 37.59.121.40"
echo "ðŸ‘¤ Utilisateur: ubuntu"
echo "ðŸ”‘ Mot de passe: Catilo"
echo ""
echo "=== Ã‰TAPE 1: DÃ©marrer le serveur HTTP local ==="
echo ""
echo "Ouvrez un nouveau terminal et exÃ©cutez:"
echo "cd /home/laurent/mesprojets/clubcreole"
echo "python3 -m http.server 8888 --directory transfer_files"
echo ""
echo "Le serveur dÃ©marrera sur http://172.28.114.141:8888"
echo ""
echo "=== Ã‰TAPE 2: Se connecter au serveur distant ==="
echo ""
echo "Dans votre terminal actuel:"
echo "ssh ubuntu@37.59.121.40"
echo "(mot de passe: Catilo)"
echo ""
echo "=== Ã‰TAPE 3: TÃ©lÃ©charger le fichier sur le serveur distant ==="
echo ""
echo "Une fois connectÃ© au serveur distant, exÃ©cutez:"
echo "mkdir -p /home/ubuntu/dumps"
echo "cd /home/ubuntu/dumps"
echo "wget http://172.28.114.141:8888/supabase_dump_20251028_164145.sql"
echo ""
echo "=== Ã‰TAPE 4: VÃ©rifier le transfert ==="
echo ""
echo "Sur le serveur distant:"
echo "ls -la supabase_dump_20251028_164145.sql"
echo "file supabase_dump_20251028_164145.sql"
echo ""
echo "=== ALTERNATIVE: Transfert par copier-coller base64 ==="
echo ""
echo "Si le HTTP ne fonctionne pas, utilisez la mÃ©thode base64:"
echo "1. Copiez le contenu du fichier: cat supabase_dump_encoded.txt"
echo "2. Sur le serveur distant:"
echo "   mkdir -p /home/ubuntu/dumps"
echo "   cd /home/ubuntu/dumps"
echo "   cat > supabase_dump_20251028_164145.sql.b64"
echo "   # collez le contenu base64 ici"
echo "   base64 -d supabase_dump_20251028_164145.sql.b64 > supabase_dump_20251028_164145.sql"
echo ""
echo "=== TEST DE CONNEXION ==="
echo ""

# Test de connexion simple
timeout 5 bash -c "</dev/tcp/37.59.121.40/22" && echo "âœ… Connexion SSH possible au serveur distant" || echo "âŒ Connexion SSH Ã©chouÃ©e"

echo ""
echo "Serveur HTTP local prÃªt: http://172.28.114.141:8888"
echo "Contenu disponible:"
ls -la transfer_files/